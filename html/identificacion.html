<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Identificaci&oacute;n</title>
  <meta name="theme-color" content="#0f6fcc">
  <link rel="manifest" href="../manifest.webmanifest">
  <link rel="apple-touch-icon" href="../assets/logo.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;600;700&display=swap" rel="stylesheet">
  <script>
    window.tailwind = window.tailwind || {};
    tailwind.config = {
      safelist: [
        "relative",
        "w-full",
        "rounded-2xl",
        "bg-white/90",
        "p-5",
        "text-left",
        "text-brand-ink",
        "font-semibold",
        "shadow-lg",
        "shadow-black/10",
        "ring-1",
        "ring-white/15",
        "backdrop-blur",
        "transition",
        "duration-200",
        "hover:-translate-y-1",
        "hover:shadow-2xl",
        "hover:ring-brand-blue/50",
        "focus:outline-none",
        "focus:ring-2",
        "focus:ring-brand-blue/40",
        "focus:ring-offset-2",
        "focus:ring-offset-slate-100",
      ],
      theme: {
        extend: {
          fontFamily: {
            display: ['-apple-system', 'BlinkMacSystemFont', '"San Francisco"', '"Segoe UI"', 'system-ui', 'sans-serif'],
          },
          colors: {
            'brand-orange': '#ff9500',
            'brand-blue': '#0a84ff',
            'brand-ink': '#0b132b',
          },
        },
      },
    };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="../css/identificacion.css" />
</head>

<body class="fade-in font-display bg-gradient-to-br from-slate-100 via-slate-50 to-white text-slate-900">
  <div class="flex min-h-screen items-center justify-center px-4 py-10">
    <div class="w-full max-w-3xl rounded-3xl bg-white/90 text-slate-900 shadow-[0_20px_60px_rgba(0,0,0,0.12)] backdrop-blur">
      <div class="flex items-start justify-between gap-4 border-b border-slate-200 px-6 py-6">
        <div class="space-y-1">
          <h2 class="text-2xl font-bold leading-tight text-brand-ink">Validacion de Vigilante</h2>
        </div>
        <button type="button"
          class="btn-retorno inline-flex items-center gap-2 rounded-full bg-slate-900/5 px-3 py-2 text-xs font-semibold text-brand-blue ring-1 ring-brand-blue/30 transition hover:bg-brand-blue hover:text-white"
          onclick="volverAlInicio()">&larr; Menu</button>
      </div>

      <form id="formIdentificacion" class="id-form space-y-6 px-6 pb-8">
        <div class="form-group space-y-3">
          <label class="text-sm font-semibold uppercase tracking-wide text-slate-600">Seleccione su empresa:</label>
          <div class="radio-group grid grid-cols-1 gap-3 sm:grid-cols-2">
            <label
              class="flex items-center gap-3 rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-brand-ink shadow-sm shadow-slate-900/5 transition hover:border-brand-blue">
              <input class="h-4 w-4 text-brand-blue focus:ring-brand-blue" type="radio" name="empresa"
                value="CORSEPRI SA" required />
              <span class="font-semibold">CORSEPRI SA</span>
            </label>
            <label
              class="flex items-center gap-3 rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-brand-ink shadow-sm shadow-slate-900/5 transition hover:border-brand-blue">
              <input class="h-4 w-4 text-brand-blue focus:ring-brand-blue" type="radio" name="empresa" value="VICMER"
                required />
              <span class="font-semibold">VICMER</span>
            </label>
          </div>
        </div>

        <div class="form-group grid gap-2">
          <label class="text-sm font-semibold uppercase tracking-wide text-slate-600">Nombre completo:</label>
          <input type="text" id="nombre" required
            class="w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-base font-semibold text-brand-ink shadow-inner shadow-slate-900/5 focus:border-brand-blue focus:outline-none focus:ring-2 focus:ring-brand-blue/30" />
        </div>

        <div class="form-group grid gap-2">
          <label class="text-sm font-semibold uppercase tracking-wide text-slate-600">DNI:</label>
          <input type="number" id="dni" required
            class="w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-base font-semibold text-brand-ink shadow-inner shadow-slate-900/5 focus:border-brand-blue focus:outline-none focus:ring-2 focus:ring-brand-blue/30" />
        </div>

        <div class="form-group space-y-2">
          <div class="flex items-center justify-between gap-3">
            <label class="text-sm font-semibold uppercase tracking-wide text-slate-600">Capture una selfie (rostro y torso):</label>
            <button type="button" id="selfieButton" onclick="openSelfieModal()"
              class="selfie-trigger inline-flex items-center justify-center rounded-full bg-white text-brand-ink ring-1 ring-slate-200 shadow-lg shadow-slate-200/70 transition hover:-translate-y-[1px] hover:ring-brand-blue/60"
              aria-label="Tomar selfie">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="22" height="22" aria-hidden="true">
                <path fill="currentColor" d="M31.55 10.5 29 13H19l-2.55-2.5H10A4.5 4.5 0 0 0 5.5 15v16A4.5 4.5 0 0 0 10 35.5h28A4.5 4.5 0 0 0 42.5 31V15A4.5 4.5 0 0 0 38 10.5h-6.45ZM24 31a7 7 0 1 1 0-14 7 7 0 0 1 0 14Zm0-3a4 4 0 1 0 0-8 4 4 0 0 0 0 8Zm10.5-11.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3Z"/>
              </svg>
            </button>
          </div>
          <canvas id="canvas"
            class="selfie-thumb hidden"></canvas>
        </div>

        <button type="submit"
          class="btn-enviar inline-flex w-full items-center justify-center gap-2 rounded-2xl border border-slate-200 bg-white/95 px-6 py-3 text-lg font-bold text-brand-ink shadow-[0_14px_35px_rgba(0,0,0,0.08)] transition hover:-translate-y-[2px] hover:shadow-[0_18px_45px_rgba(0,0,0,0.12)] focus:outline-none focus:ring-2 focus:ring-brand-blue/40">&#10003;
          Validar e Ingresar</button>
        <p id="mensaje" class="mensaje-estado text-center text-sm font-semibold text-brand-blue"></p>
      </form>
    </div>
  </div>

  <!-- Modal de selfie -->
  <div id="selfieModal" class="selfie-modal hidden" aria-hidden="true">
    <div class="selfie-modal__backdrop"></div>
    <div class="selfie-modal__dialog">
      <div class="selfie-modal__video-wrapper">
        <video id="video" autoplay playsinline class="selfie-modal__video"></video>
      </div>
      <div class="selfie-modal__controls">
        <button type="button" class="selfie-modal__close" onclick="closeSelfieModal()">✕</button>
        <button type="button" class="selfie-modal__capture" onclick="capturarFoto()">●</button>
      </div>
    </div>
  </div>

  <!-- 1. Cargar la librer&iacute;a de Supabase primero -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- 2. Archivo donde inicializas Supabase -->
  <script src="../js/supabase.js"></script>

  <!-- 3. Luego el main que la usa -->
  <script src="../js/main.js"></script>

  <!-- 4. Finalmente, la c&aacute;mara -->
  <script src="../js/camera.js"></script>
</body>
</html>
